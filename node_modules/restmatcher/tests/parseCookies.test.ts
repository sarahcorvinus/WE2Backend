import express from 'express';
import supertest from 'supertest';
import { parseCookies } from '../src/restmatcher';


test("parseCookies", async () => {
    const app = express();
    app.get("/path", (req, res) => {
        res.cookie("someName", "someData", {
            httpOnly: true,
            secure: true
        })
        res.send("nothing");
    });


    const testee = supertest(app);
    const responseRaw = await testee.get(`/path`);
    expect(responseRaw).not.toHaveProperty("cookies");
    expect(responseRaw).not.toHaveProperty("cookiesRaw");
    
    const response = parseCookies(responseRaw);
    
    // added properties:
    expect(responseRaw).toHaveProperty("cookies");
    expect(responseRaw).toHaveProperty("cookiesRaw");

    // the value (as provided by express middleware cookieParser)
    expect(response.cookies.someName).toBe("someData");

    // the raw cookie (as provided by set-cookie-parser)
    const rawCookie = response.cookiesRaw.find(c => c.name === "someName");
    expect(rawCookie).toBeDefined();
    expect(rawCookie?.httpOnly).toBeTruthy();

});    